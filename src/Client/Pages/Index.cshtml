@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<script type="module">
    //import Vue from 'https://unpkg.com/vue@2.6.0/dist/vue.esm.browser.min.js';
    import { createApp } from './lib/vue/vue.esm-browser.min.js';

    function parseJwt(token) {
        if (token != undefined && token != "") {
            var base64Url = token.split('.')[1];
            var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));

            var result = JSON.parse(jsonPayload);

            return result;
        }

        return "";
    };

    function unixTicksToIsoString(seconds) {        
        var expiryDateTime = new Date(seconds * 1000);
        return expiryDateTime.toISOString();
    }

    const app = createApp({
        data() {
            return {
                token: "",
                refreshToken: "",
                tokenExpires: ""
            }
        },
        computed: {
            decodedToken: function() {
                if (this.token != undefined && this.token != "") {
                    var result = parseJwt(this.token);
                    this.tokenExpires = unixTicksToIsoString(result['exp']);
                    return result;
                }
                else {
                    this.expiryDate = "";
                    return "";
                }
            },
            refreshTokenExpires: function() { 
                if (this.refreshToken != undefined && this.refreshToken != "") {
                    var result = parseJwt(this.refreshToken);
                    return unixTicksToIsoString(result['exp']);
                }
                else {
                    this.expiryDate = "";
                    return "";
                }
            }
        },
        methods: {
            authenticate() {
                this.token = "eyJhbGciOiJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNyc2Etc2hhMjU2IiwidHlwIjoiSldUIiwia2lkIjoiN2I3NmVhODBmNjA5Yzg4NDRlOTZjM2FmMGIyNThhMGYyYjdhMjBiYSJ9.eyJzY29wZSI6InRlc3QiLCJzdWIiOiI3YWMzOTUwNC01M2YxLTQ3ZjUtOTZiOS0zYzI2ODI5NjJiOGIiLCJuYmYiOjE2NTkyNzY1NDIsImV4cCI6MTY1OTI3NjYwMiwiaXNzIjoiaHR0cHM6Ly9naXRodWIuY29tL0pvZUpvZVdhbHRlcnMvSWRlbnRpdHlQcm92aWRlciIsImF1ZCI6IlN5c3RlbSBBIn0.BPz0F5UmCoBjSyF4t8QQpFA9jskf4sv3bxCG0P0L6nA4Tzd_7d5KBnrtwsgns3-ZtjxL8HbLYwEQtHIMup2bMeXoaM5ftxfQf5-bD-QaLhhgNPWvWrXqGba2vDgBJAx4Vu4LY40KTm2Kju8o0wUcBHexJnwqMq-qY-N-nKhJr3yuStJmkrgToe-kFqdiff3Q6N71FTgXfYjg6RcFbw0nwezyi5QzWRWX1JDikvmf5SsKXk2mr_0sfcxjyaPVQaWokyCLzMx7nRDYkqZxZ9vDpvFtIBoXalesepnxjo55ug51HBGIeRHoDwY8AU6P6coqhUucf76fm6J90S4mDyWAUw";
                this.refreshToken = "eyJhbGciOiJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNyc2Etc2hhMjU2IiwidHlwIjoiUmVmcmVzaCIsImtpZCI6IjdiNzZlYTgwZjYwOWM4ODQ0ZTk2YzNhZjBiMjU4YTBmMmI3YTIwYmEifQ.eyJzY29wZSI6InRlc3QiLCJzdWIiOiI3YWMzOTUwNC01M2YxLTQ3ZjUtOTZiOS0zYzI2ODI5NjJiOGIiLCJuYmYiOjE2NTkyNzY1NDIsImV4cCI6MTY1OTI4MDE0MiwiaXNzIjoiaHR0cHM6Ly9naXRodWIuY29tL0pvZUpvZVdhbHRlcnMvSWRlbnRpdHlQcm92aWRlciIsImF1ZCI6IlN5c3RlbSBBIn0.WxKNyen3uYj_QeFiK35zqRWT08oO3Mi6ry2ox3hJmRKs8nKUNxd9L1aha6Tkq82xeVEdUPYCKP7svnIGwsV3TMhxUX_3K-Cco592TU6OqNfFY8PuJw1GvcDlsafaVO6ZCZqBz3waTJORI-6QGV_rL_SQU-htMdwE1Ij9vmp3gthWMb8LvzFMrUI7eNPLsSkCTYfmoQph1WQAI93WPGBU_3GcwDzhvrm-TQC8DaP4feF9w5aUm2AtlxrylgTARyVDvf1iRz62zP5JXgRcNgDUObk9qQI3isGGRqxhX13h7Tfzx9RPf2C4NF1lH0TzhKATKZ_BhkRRxiizyawl087-Qg";
            }
        },
    }).mount('#app');
</script>

<div>
    <h1 class="display-4">Login</h1>
    <form id="LoginForm">
        <div class="form-group">
            <label for="loginAudience">Audience</label>
            <select class="form-control" id="loginAudience">
                <option>System A</option>
                <option>System B</option>
            </select>
        </div>
        <div class="form-group">
            <label for="loginType">Type</label>
            <select class="form-control" id="loginType">
                <option value="authorization_code">Authorization Code</option>
                <option value="client_credentials">Client Credentials</option>
                <option value="password">Password</option>
                <option value="refresh_token">Refresh Token</option>
            </select>
        </div>
        <div class="form-group">
            <label for="loginUsername">Username</label>
            <input type="text" class="form-control" id="loginUsername" aria-describedby="usernameHelp" placeholder="Enter Username">
            <small id="usernameHelp" class="form-text text-muted">Please enter your username.</small>
        </div>
        <div class="form-group">
            <label for="loginPassword">Password</label>
            <input type="password" class="form-control" id="loginPassword" placeholder="Password">
        </div>
        <button type="button" class="btn btn-primary" v-on:click="authenticate">Authenticate</button>
    </form>
</div>
